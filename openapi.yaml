openapi: 3.1.0
info:
  title: Querator API
  description: |
    **Querator** is a Distributed Durable Execution System built on top of an Almost Exactly Once Delivery (AEOD) Queue.
    
    ## Core Features
    
    ### Almost Exactly Once Delivery
    Querator provides high-throughput, lease-based queue operations with Almost Exactly Once Delivery semantics. 
    Unlike streaming systems, items are leased to consumers who gain exclusive processing rights until completion or retry.
    
    ### Lease-Based Processing
    - **Exclusive Access**: Consumers lease items with guaranteed exclusive processing rights
    - **Timeout Protection**: Automatic re-queuing if lease deadline expires
    - **Flexible Completion**: Items can be completed, retried, or moved to dead letter queues
    
    ### Scheduled Delivery
    Support for scheduled item delivery via `enqueue_at` timestamps, enabling delayed processing and retry scheduling.
    
    ### Horizontal Scaling
    - **Partitioned Queues**: Each queue can have multiple partitions for parallel processing
    - **Automatic Load Balancing**: Consumers are automatically distributed across partitions
    - **Pluggable Storage**: Support for multiple storage backends (BadgerDB, Memory, with PostgreSQL/MySQL planned)
    
    ## API Design
    
    The API follows a lease-based workflow:
    1. **Produce** items to queues with optional scheduling
    2. **Lease** items for exclusive processing with configurable timeouts  
    3. **Complete** processed items or **Retry** failed items
    4. **Manage** queues and inspect storage state
    
    All operations support batch processing for high throughput scenarios.
    
    ## Storage Backends
    
    Querator supports pluggable storage backends with minimal requirements (ordered primary keys only):
    - **Memory**: In-memory storage for testing and ephemeral workloads
    - **BadgerDB**: Embedded storage for single-instance deployments
    - **Planned**: PostgreSQL, MySQL, SurrealDB, FoundationDB
    
    For more information, visit [querator.io](https://querator.io) or the [GitHub repository](https://github.com/kapetan-io/querator).
  version: 0.1.0
  contact:
    name: Querator Team
    url: https://github.com/kapetan-io/querator
    email: querator@kapetan.io
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
tags:
  - name: Querator V1
    description: |
      Core queue operations including produce, lease, complete, retry, and queue management.
      
      **Queue Operations:**
      - `queue.produce` - Add items to queues with optional scheduling
      - `queue.lease` - Lease items for exclusive processing
      - `queue.complete` - Mark leased items as successfully processed
      - `queue.retry` - Retry failed items or move to dead letter queue
      - `queue.stats` - Get queue performance statistics
      - `queue.clear` - Clear queue data (destructive operation)
      
      **Queue Management:**
      - `queues.create` - Create new queues with specified configuration
      - `queues.list` - List all available queues with pagination
      - `queues.info` - Get detailed information about a specific queue
      - `queues.update` - Update queue configuration
      - `queues.delete` - Delete queues and associated data
      
      **Storage Operations:**
      - `storage/items.*` - Direct storage inspection and manipulation
      - Low-level operations for debugging and data migration
paths:
  /v1/queue.produce:
    post:
      summary: Produce an item on a queue
      deprecated: false
      description: >-
        Produce an item on a queue. Calls to the endpoint may provide multiple
        items to produce. The call will not return until all items provided have
        been written to storage.

        ### Timeout Semantics

        The call will return when the item(s) provided are written to storage or
        when `request_timeout` has been reached. If the call returns with a non
        200 response code, the client should consider the items provided as not
        written to the queue. The client should NOT cancel the request before
        `request_timeout` has been reached. If the call fails to return after
        `request_timeout` is reached the client can safely cancel the request.
      operationId: post-v1-queue.produce
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueueProduceRequest'
            example:
              queue_name: queue-name
              request_timeout: 30s
              items:
                - encoding: application/json
                  kind: webhook-v2
                  reference: account-1234
                  utf8: '{"key":"value"}'
                - encoding: application/json
                  kind: webhook-v2
                  reference: account-5323
                  bytes: eyJrZXkiOiJ2YWx1ZSJ9
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueProduceResponse'
              examples:
                '1':
                  summary: Success
                  value:
                    code: 200
          headers: {}
      security: []
  /v1/queue.lease:
    post:
      summary: Lease items from the queue
      deprecated: false
      description: >+
        Lease a items from the requested queue.  When a items is lease
        by a consumer, that consumer gains exclusive rights to the items. No
        other consumer will be provided the same items unless the
        `lease_deadline` has expired 

        and the consumer with the lease has not marked the items via 
        `/queue.complete` or `/queue.retry`


        If a items is not acknowledge via `/queue.complete` within the
        `lease_deadline` period it will be offered to another consumer.


        ### Timeout Semantics

        The call will return when a lease is successful or when
        `request_timeout` has been reached. If the call returns with a 454
        `Retry Request` response code, this means there were no items in the
        queue and the `request_timeout` was reached. In this case the client
        should retry the lease request.


        The client should NOT cancel the request before `request_timeout` has
        been reached. If the call fails to return after `request_timeout` is
        reached the client can safely cancel the request.


      operationId: post-v1-queue.lease
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueueLeaseRequest'
            example:
              queue_name: queue-name
              batch_size: 1000
              client_id: client-01
              request_timeout: 30s
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueLeaseResponse'
              examples:
                '1':
                  summary: Example 1
                  value:
                    items:
                      - encoding: application/json
                        kind: webhook-v2
                        reference: account-1234
                        id: 2m75RTp9PBx69hw1Q7mjoB0F73Q
                        lease_deadline: '2024-07-02T20:50:49.366215Z'
                        bytes: >-
                          R29vZCBuZXdzIGV2ZXJ5b25lLCBteSBJUSB0ZXN0IGNhbWUgYmFjayBuZWdhdGl2ZQ==
                    queue_name: webhooks
                    partition: 0
          headers: {}
      security: []
  /v1/queue.retry:
    post:
      summary: Retry items
      deprecated: false
      description: >
        Retry an item to be processed again at a later date/time. Once the
        `retry_at` time is reached, querator will enqueue this item into the
        specified queue and the `attempted` counter for this item will increment
        by 1. 


        If the item should not be retried, but failed immediately. Set `dead:
        true` and the item will be placed in the dead letter queue regardless of
        the number of attempts left on the items.


        If you wish to fail a items such that it is deleted from the queue and
        never offered to another consumer, nor placed into the dead letter
        queue, then call `/queue.complete` instead.
      operationId: post-v1-queue.retry
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueueRetryRequest'
            example:
              queue_name: queue-name
              partition: 0
              items:
                - id: 2m75RTp9PBx69hw1Q7mjoB0F73Q
                  retry_at: '2024-01-01 12:00:00.0000'
                  dead: false
                - id: 2m75RTp9PBx69hw1Q7mjoB0F73R
                  retry_at: '2024-01-01 12:00:00.0000'
                  dead: false
                - id: 2m75RTp9PBx69hw1Q7mjoB0F73S
                  retry_at: '2024-01-01 12:00:00.0000'
                  dead: false
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueRetryResponse'
              examples:
                '1':
                  summary: Success
                  value:
                    code: 200
          headers: {}
      security: []
  /v1/queue.complete:
    post:
      summary: Complete leased items
      deprecated: false
      description: >
        Mark `leased` items as `completed`. The item can then be removed from
        the queue by Querator and will not be offered to any other consumers.


        If any of the ids provided cannot be marked as `completed` then the
        entire request will be rejected with a code `453 Request Failed`. It is
        the responsibility of the client to remove the offending id and try
        again.


        ### Timeout Semantics

        The call will return when the id(s) provided are completed to storage or
        when `request_timeout` has been reached. If the call returns with a non
        200 response code, the client should consider the items provided as not
        completed to the queue. The client should NOT cancel the request before
        `request_timeout` has been reached. If the call fails to return after
        `request_timeout` is reached the client can safely cancel the request.
      operationId: post-v1-queue.complete
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueueCompleteRequest'
            example:
              queue_name: queue-name
              partition: 0
              request_timeout: 30s
              ids:
                - id-1234
                - id-1235
                - id-1236
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueCompleteResponse'
              examples:
                '1':
                  summary: Success
                  value:
                    code: 200
          headers: {}
      security: []
  /v1/queues.list:
    post:
      summary: List all available queues
      deprecated: false
      description: List all the available queues
      operationId: post-v1-queues.list
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueuesListRequest'
            example:
              pivot: queue-302
              limit: 500
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueuesListResponse'
              examples:
                '1':
                  summary: Success
                  value:
                    items:
                      - name: queue-1
                        created_at: '2024-01-01 12:00:00.0000'
                        updated_at: '2024-01-01 12:00:00.0000'
                        dead_queue: queue-1-dead
                        reference: jake@statefarm.com
                        lease_timeout: 60m
                        expire_timeout: 24h
                        max_attempts: 10
                        requested_partitions: 5
                      - name: queue-2
                        created_at: '2024-01-01 12:00:00.0000'
                        updated_at: '2024-01-01 12:00:00.0000'
                        dead_queue: queue-2-dead
                        reference: jake@statefarm.com
                        lease_timeout: 60m
                        expire_timeout: 24h
                        max_attempts: 20
                        requested_partitions: 1025
          headers: {}
      security: []
  /v1/queues.create:
    post:
      summary: Create a queue
      deprecated: false
      description: Create a new queue with the provided characteristics
      operationId: post-v1-queues.create
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema: &ref_0
              $ref: '#/components/schemas/QueueInfo'
            example:
              queue_name: queue-name
              dead_queue: queue-name-dead
              reference: jake@statefarm.com
              lease_timeout: 60m
              expire_timeout: 24h
              max_attempts: 10
              requested_partitions: 25
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema: &ref_1
                $ref: '#/components/schemas/Reply'
              examples:
                '1':
                  summary: Success
                  value: |-
                    {
                        "code": 200,

                    }
          headers: {}
      security: []
  /v1/queues.update:
    post:
      summary: Update a queue
      deprecated: false
      description: Update the details of a queue.
      operationId: post-v1-queues.update
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema: *ref_0
            example:
              queue_name: queue-name
              dead_queue: queue-name-dead
              reference: account-12345
              lease_timeout: 60m
              expire_timeout: 24h
              max_attempts: 35
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema: *ref_1
              examples:
                '1':
                  summary: Success
                  value:
                    code: 200
          headers: {}
      security: []
  /v1/queues.info:
    post:
      summary: Get Info about a queue
      deprecated: false
      description: ''
      operationId: post-v1-queues.info
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: The name of the queue to retrieve info about
              required:
                - name
            example:
              name: queue-name
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema: *ref_0
              examples:
                '1':
                  summary: Success
                  value:
                    name: queue-name
                    created_at: '2024-01-01 12:00:00.0000'
                    updated_at: '2024-01-01 12:00:00.0000'
                    dead_queue: queue-name-dead
                    reference: jake@statefarm.com
                    lease_timeout: 60m
                    expire_timeout: 24h
                    max_attempts: 50
                    requested_partitions: 456
          headers: {}
      security: []
  /v1/queues.delete:
    post:
      summary: Delete a queue
      deprecated: false
      description: >-
        Delete a queue and all associated data. Use the force parameter to
        delete queues that have active items or leases.
      operationId: post-v1-queues.delete
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueuesDeleteRequest'
            example:
              queue_name: queue-name
              force: true
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Reply'
              examples:
                '1':
                  summary: Success
                  value:
                    code: 200
          headers: {}
      security: []
  /v1/queue.stats:
    post:
      summary: Fetch stats for a queue
      deprecated: false
      description: >-
        Retrieve statistics about a queue. Queue stats provide information on
        the health of a partition in a queue
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueueStatsRequest'
            example:
              queue_name: queue-name
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueStatsResponse'
              examples:
                '1':
                  summary: Queue Stats Example
                  value:
                    queue_name: queue-name
                    logical_queues:
                      - produce_waiting: 12
                        lease_waiting: 32
                        complete_waiting: 2
                        in_flight: 54
                        partitions:
                          - partition: 0
                            total: 65012
                            total_leased: 5000
                            average_age: 1m23s
                            average_leased_age: 43s
                      - produce_waiting: 12
                        leased_waiting: 32
                        complete_waiting: 2
                        in_flight: 54
                        partitions:
                          - partition: 1
                            total: 65012
                            total_leased: 5000
                            average_age: 1m23s
                            average_leased_age: 43s
                          - partition: 2
                            total: 650133
                            total_leased: 5000
                            average_age: 1m23s
                            average_leased_age: 43s
          headers: {}
      security: []
  /v1/queue.clear:
    post:
      summary: Clear a queue
      deprecated: false
      description: >-
        Clears all data from a queue, optionally clears all retry and scheduled
        items
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueueClearRequest'
            example:
              queue_name: queue-name
              retry: false
              scheduled: false
              queue: true
              destructive: true
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema: *ref_1
              examples:
                '1':
                  summary: Success
                  value:
                    code: 200
          headers: {}
      security: []
  /v1/storage/items.list:
    post:
      summary: List Items in a Partition
      deprecated: false
      description: List items in a queue partition
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageItemsListRequest'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageItemsListResponse'
          headers: {}
      security: []
  /v1/storage/items.import:
    post:
      summary: Import Items to a Partition
      deprecated: false
      description: Import items into a partition
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageItemsImportRequest'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageItemsImportResponse'
          headers: {}
      security: []
  /v1/storage/items.delete:
    post:
      summary: Delete items from a partition
      deprecated: false
      description: ''
      tags:
        - Querator V1
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageItemsDeleteRequest'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema: *ref_1
              examples:
                '1':
                  summary: Success
                  value:
                    code: 200
          headers: {}
      security: []
components:
  schemas:
    Inspect-Request:
      type: object
      properties:
        id:
          type: string
          x-stoplight:
            id: 16fo5kqzhzqi2
      title: Inspect
      x-stoplight:
        id: ltyj6nx3rxht5
    QueueProduceRequest:
      type: object
      properties:
        queue_name:
          type: string
          description: The name of the queue
          examples:
            - queue1
            - queue2
        request_timeout:
          type: string
          description: >-
            The duration this request should block before the client will cancel
            the request
          default: 5m
          examples:
            - 5m
            - 15m
            - 30s
        items:
          type: array
          items:
            $ref: '#/components/schemas/QueueProduceItem'
          description: List of items to be queued
          maxItems: 1000
          minItems: 1
      required:
        - queue_name
        - request_timeout
        - items
    QueueLeaseRequest:
      type: object
      properties:
        queue_name:
          type: string
          description: The name of the queue
        client_id:
          type: string
          description: >-
            A unique id which identifies this client. Duplicate client id's are
            not allowed
          examples:
            - client-1234
        request_timeout:
          type: string
          default: 1m
          examples:
            - 30s
            - 1m
            - 5m
            - 15m
          description: >-
            The duration this request should block before the client will cancel
            the request.
        batch_size:
          type: integer
          minimum: 1
          maximum: 1000
          description: The maximum number of items to be leased for this request
      required:
        - queue_name
        - client_id
        - request_timeout
    QueueCompleteRequest:
      type: object
      properties:
        queue_name:
          type: string
          description: The name of the queue these ids are from
        partition:
          type: integer
          description: The Partition these ids are from
        request_timeout:
          type: string
          description: >-
            The duration this request should block before the client will cancel
            the request
        ids:
          type: array
          items:
            type: string
            description: A list of ids to mark complete
          description: A list of the item ids to mark as complete
      required:
        - queue_name
        - request_timeout
        - ids
        - partition
    QueueRetryRequest:
      type: object
      properties:
        queue_name:
          type: string
          description: >-
            The queue name provided when the item was leased. If the
            `queue_name` does not match the original `queue_name` provided when
            the item was leased, then the retry request will return a non 200
            status code.
        partition:
          type: integer
          description: >-
            The partition provided when the item was leased. If the
            `partition` does not match the original `partition` provided when
            the item was leased, then the retry request will return a non 200
            status code.
        items:
          type: array
          items:
            $ref: '#/components/schemas/QueueRetryItem'
      required:
        - queue_name
        - partition
        - items
    QueueStatsRequest:
      type: object
      properties:
        queue_name:
          type: string
      required:
        - queue_name
    QueueClearRequest:
      type: object
      properties:
        queue_name:
          type: string
          description: The name of the queue to clear
        retry:
          type: boolean
          description: >-
            Indicates the 'retry' queue will be cleared. If true, any items
            scheduled to be retried at a future date will be removed.
        scheduled:
          type: boolean
          description: >-
            Indicates any 'scheduled' items in the queue will be cleared. If
            true, any items scheduled to be enqueued at a future date will be
            removed.
        queue:
          type: boolean
          description: >-
            Indicates any items currently waiting in the FIFO queue will clear.
            If true, any items in the queue which have NOT been leased will be
            removed.
        destructive:
          type: boolean
          description: >-
            Indicates the Retry, Scheduled, Queue operations should be destructive
            in that all data regardless of status will be removed.

            For example, if used with ClearRequest.Queue = true, then ALL items
            in the queue regardless of lease status will be removed. This
            means that clients who currently have ownership of those items will
            not be able to "complete" those items, as querator will have no
            knowledge of those items.
      required:
        - queue_name
        - retry
        - scheduled
        - queue
        - destructive
    QueuesListRequest:
      type: object
      properties:
        pivot:
          type: string
          description: >-
            The name of the queue to pivot upon when paging through lists of
            queues
        limit:
          type: integer
          maximum: 1000
          description: The maximum number of items to return in a single list response
      required:
        - pivot
        - limit
    QueuesDeleteRequest:
      type: object
      properties:
        queue_name:
          type: string
          description: The name of the queue to delete
          examples:
            - queue-name
        force:
          type: boolean
          description: >-
            force indicates the deletion should ignore any current open
            leases or items in the queue and delete all data related to
            the queue. In addition, this forcibly cancels all in progress client
            lease requests.
      required:
        - queue_name
        - force
    StorageItemsListRequest:
      type: object
      properties:
        queue_name:
          type: string
        partition:
          type: integer
        pivot:
          type: string
        limit:
          type: integer
      required:
        - queue_name
        - partition
        - pivot
        - limit
    StorageItemsImportRequest:
      type: object
      properties:
        queue_name:
          type: string
        partition:
          type: integer
        items:
          type: array
          items: &ref_2
            $ref: '#/components/schemas/StorageItem'
      required:
        - queue_name
        - partition
        - items
    StorageItemsDeleteRequest:
      type: object
      properties:
        queue_name:
          type: string
        partition:
          type: integer
          description: The partition number these ids belong to
        ids:
          type: array
          items:
            type: string
      required:
        - queue_name
        - partition
        - ids
    Inspect:
      type: object
      properties:
        queue_name:
          type: string
        partitions:
          type: string
        queued:
          type: integer
          format: int64
        retried:
          type: integer
          format: int64
        scheduled:
          type: integer
          format: int64
        dead_letter:
          type: integer
          format: int64
    QueueProduceResponse:
      type: object
      properties:
        code:
          type: integer
          description: The response code
        code_text:
          type: string
          description: The text explanation of the code
        message:
          type: string
          description: The message that contains details explaining the reason for the code
      required:
        - code
    QueueLeaseResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/QueueLeaseItem'
        queue_name:
          type: string
          description: The name of the queue the leased items are from
        partition:
          type: integer
          description: Partition the leased items are from
      required:
        - items
        - queue_name
        - partition
    QueueCompleteResponse:
      type: object
      properties:
        code:
          type: integer
          description: The response code
        code_text:
          type: string
          description: The text explanation of the code
        message:
          type: string
          description: The message that contains details explaining the reason for the code
      required:
        - code
    QueueRetryResponse:
      type: object
      properties:
        code:
          type: integer
          description: The response code
        code_text:
          type: string
          description: The text explanation of the code
        message:
          type: string
          description: The message that contains details explaining the reason for the code
      required:
        - code
    QueueStatsResponse:
      type: object
      properties:
        queue_name:
          type: string
        logical_queues:
          type: array
          items:
            $ref: '#/components/schemas/QueueLogicalStats'
      required:
        - queue_name
        - logical_queues
    QueuesListResponse:
      type: object
      properties:
        items:
          type: array
          items: *ref_0
      required:
        - items
    StorageItemsListResponse:
      type: array
      items: *ref_2
    StorageItemsImportResponse:
      type: array
      items: *ref_2
    Reply:
      type: object
      properties:
        code:
          type: integer
          description: Response status code
        code_text:
          type: string
          description: Human readable status message
        message:
          type: string
          description: Additional details about the response
      required:
        - code
    QueueProduceItem:
      type: object
      properties:
        encoding:
          type: string
          description: >-
            A user specified field which indicates the encoding the user used to
            encode the payload
          examples:
            - application/json
            - application/xml
        kind:
          type: string
          description: >-
            A user specified field that describes the kind or type the payload
            contains. Consumers can use this field to determine handling of the
            payload prior to unmarshalling
          examples:
            - webhook-v2
            - webhook-v1
        reference:
          type: string
          description: >-
            A user specified field that can be used by the consumer to determine
            handling of the item without needing to unmarshall the body
          examples:
            - john.smith
            - jake@insurance.com
        bytes:
          type: string
          description: >-
            The payload of the item as an array of raw bytes with no
            predetermined character set. Clients who communicate with Querator
            with `Content-Type: application/protobuf` should use this field
            instead of `utf8`


            When using `Content-Type: application/json` this field must be
            encoded as base64. If you are using `Content-Type: application/json`
            and your payload is using the utf8 character set, then you should
            use the `utf8` field instead. 
          examples:
            - eyJrZXkiOiJ2YWx1ZSJ9
        utf8:
          type: string
          description: >-
            This is an a convenience field useful for clients that are
            communicating with Querator via`Content-Type: application/json`.
            This field assumes a utf8 encoded payload and does not require the
            payload to be encoded as base64. As such is is an excellent choice
            for clients who do not have access to a base64 encoder and can't use
            the `bytes` field for their payload.


            NOTE: Both `bytes` and `utf8` can be set, but `bytes` takes
            precedence. If `bytes` is set, then that will be used as the
            payload. If `utf8` is set and `bytes` is empty, then `utf8` will be
            used. If both `bytes` and `utf8` are set, then `bytes` will be used
            and `utf8` will be dropped.
          examples:
            - Hello World!
            - '{"key": "value"}'
    QueueLeaseItem:
      type: object
      properties:
        id:
          type: string
          description: ' A unique id which identifies an item in a queue'
        encoding:
          type: string
          description: ' A user specified field which indicates the encoding the user used to encode the payload'
        kind:
          type: string
          description: >-
            A user specified field that describes the kind or type the payload
            contains. Consumers can use this field to determine handling of the
            payload prior to unmarshalling
        reference:
          type: string
          description: >-
            A user specified field that can be used by the consumer to determine
            handling of the item without needing to unmarshall the body
        attempts:
          type: integer
          description: >-
            The number of times this item has been retried or leased, and timed
            out during processing by a consumer
        lease_deadline:
          type: string
          description: >-
            The date time that Querator will offer up this item to another
            consumer if the consumer reserving this item has not marked it
            complete. The consumer can use this date to decide if it should
            finalize it's work if the timeout date has expired.
        bytes:
          type: string
          description: >-
            The payload of the item is an array of raw bytes without a
            predetermined character set. 


            NOTE: When communicating with Querator and using the `Content-Type:
            application/json` header, the 'bytes' field will be encoded in
            base64. This is necessary because byte fields, unlike string fields,
            can contain non-UTF8 binary data. Since raw bytes cannot be directly
            represented in JSON, Querator base64 encodes this field for
            consumers who prefer JSON payloads.
      required:
        - id
        - lease_deadline
    QueueRetryItem:
      type: object
      properties:
        id:
          type: string
          description: >-
            The item id provided when the item was leased. If the item id
            provided does not match an item id already in `lease` status, then
            the retry request will return a non 200 status code.
        retry_at:
          type: string
          format: date-time
          description: >-
            The timestamp after which the item will be queued to the
            queue/partition specified. If `retry_at` is empty the item will be
            immediately re-added to the queue and the attempts counter
            incremented.
        dead:
          type: boolean
          description: >-
            Indicates the item is dead, will not be retried regardless of the
            number of attempts remaining. If set to `true` the retry will  place
            the item in the dead letter queue for the specified queue.
      required:
        - id
        - retry_at
        - dead
    QueuePartitionStats:
      type: object
      properties:
        partition:
          type: integer
          description: The partition the stats are for
        total:
          type: integer
          description: Total is the number of items in the partition
        total_leased:
          type: integer
          description: The number of items in the partition that are in leased state
        average_age:
          type: string
          description: The average age of all items in the partition
      required:
        - total
        - partition
        - total_leased
        - average_age
    QueueLogicalStats:
      type: object
      properties:
        average_leased_age:
          type: string
          description: The average age of leased items in the partition
        produce_waiting:
          type: integer
          description: >-
            The number of `/queue.produce` requests currently waiting to be
            processed by the sync loop
        lease_waiting:
          type: integer
          description: >-
            The number of `/queue.lease` requests currently waiting to be
            processed by the sync loop
        complete_waiting:
          type: integer
          description: >-
            the number of `/queue.complete` requests currently waiting to be
            processed by the sync loop
        in_flight:
          type: integer
          description: >-
            The total number of requests currently in flight waiting for
            responses from the sync loop
        partitions:
          type: array
          items:
            $ref: '#/components/schemas/QueuePartitionStats'
      required:
        - average_leased_age
        - produce_waiting
        - lease_waiting
        - complete_waiting
        - in_flight
        - partitions
    QueueInfo:
      type: object
      properties:
        queue_name:
          type: string
          description: The name of the queue
          examples:
            - queue-name
        created_at:
          type: string
          description: The timestamp the queue was created
          format: date-time
          examples:
            - '2024-01-01 12:00:00.0000'
        updated_at:
          type: string
          description: The timestamp the queue was last updated
          format: date-time
          examples:
            - '2024-01-01 12:00:00.0000'
        dead_queue:
          type: string
          description: >-
            The name of the dead letter queue for this queue. If this is a dead
            letter queue then this field will be empty when retrieved via
            `/queue.list`
          examples:
            - queue-name-dead
        reference:
          type: string
          description: >-
            This is a user supplied field which could contain metadata or
            specify who owns this queue
          examples:
            - jake@statefarm.com
            - stapler@office-space.com
            - account-12345
        lease_timeout:
          type: string
          description: The default lease timeout for this queue
          examples:
            - 60m
        expire_timeout:
          type: string
          description: >-
            How long an item can wait in the queue regardless of attempts before
            it is moved to the dead letter queue
          examples:
            - 24h
        max_attempts:
          type: integer
          description: >-
            The maximum number of times an item can be retried by a consumer
            before it is placed in the dead letter queue or removed. 
            Infinite attempts if max_attempts is set to '0'. `lease_timeout`
            violations are included as attempts
        requested_partitions:
          type: integer
          description: >-
            The number of partitions this queue has requested. This might be
            different than the number of currently active partitions as the
            system grows or contracts the number of partitions.
      required:
        - queue_name
        - requested_partitions
        - created_at
        - updated_at
        - dead_queue
        - max_attempts
        - reference
        - lease_timeout
        - expire_timeout
    StorageItem:
      type: object
      properties:
        id:
          type: string
        is_leased:
          type: boolean
        lease_deadline:
          type: string
        dead_deadline:
          type: string
        expire_deadline:
          type: string
          format: date-time
          description: The deadline when this item expires and moves to dead letter queue
        created_at:
          type: string
        updated_at:
          type: string
        enqueue_at:
          type: string
          format: date-time
          description: The timestamp when this item should be enqueued for processing
        attempts:
          type: integer
        max_attempts:
          type: integer
        reference:
          type: string
        encoding:
          type: string
        kind:
          type: string
        payload:
          type: string
      required:
        - id
        - is_leased
        - lease_deadline
        - dead_deadline
        - expire_deadline
        - created_at
        - updated_at
        - enqueue_at
        - attempts
        - max_attempts
        - reference
        - encoding
        - kind
        - payload
  securitySchemes: {}
servers:
  - url: http://localhost:9090
    description: Local development server
  - url: https://api.querator.io
    description: Production server (example)
